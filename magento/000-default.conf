<VirtualHost *:80>
    ServerName vps.packrette.fr
    Redirect permanent / https://vps.packrette.fr
</VirtualHost>

<VirtualHost *:443>
 
  ServerAdmin webmaster@boxo.neotiq.com
  ServerName vps.packrette.fr
    DocumentRoot /var/www/html/pub

    <Directory /var/www/html/pub>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

  ErrorLog ${APACHE_LOG_DIR}/error.log
  CustomLog ${APACHE_LOG_DIR}/access.log combined

    SSLEngine on
    SSLCertificateFile "/var/www/letsencrypt/certs/live/vps.packrette.fr/fullchain.pem"
    SSLCertificateKeyFile "/var/www/letsencrypt/certs/live/vps.packrette.fr/privkey.pem"

</VirtualHost>

<VirtualHost *:80>
    ServerName backend.packrette.fr
    Redirect permanent / https://backend.packrette.fr
</VirtualHost>

<VirtualHost *:443>
    ServerName backend.packrette.fr

    ProxyPreserveHost On
    ProxyPass / http://backend:8082/
    ProxyPassReverse / http://backend:8082/
    SSLEngine on
    SSLCertificateFile "/var/www/letsencrypt/certs/live/backend.packrette.fr/fullchain.pem"
    SSLCertificateKeyFile "/var/www/letsencrypt/certs/live/backend.packrette.fr/privkey.pem"
</VirtualHost>


<VirtualHost *:80>
    ServerName frontend.packrette.fr
    Redirect permanent / https://frontend.packrette.fr
</VirtualHost>

<VirtualHost *:443>
    ServerName frontend.packrette.fr

    ProxyPreserveHost On
    ProxyPass / http://frontend:8081/
    ProxyPassReverse / http://frontend:8081/
    SSLEngine on
    SSLCertificateFile "/var/www/letsencrypt/certs/live/frontend.packrette.fr/fullchain.pem"
    SSLCertificateKeyFile "/var/www/letsencrypt/certs/live/frontend.packrette.fr/privkey.pem"
</VirtualHost>